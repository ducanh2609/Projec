<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<style>
    * {
        padding: 0px;
        margin: 0px;
    }

    .container {
        background-image: url(/Lybrary/background-cay-xanh-hinh-cay-truc-800x450.jpg);
        width: 100%;
        height: 100vh;
        background-size: 100% 100%;
        position: relative;
        place-items: center;
    }

    .login {
        position: relative;
        margin: 0px auto;
        top: 100px;
        border: 2px solid green;
        width: 400px;
        height: 600px;
        box-sizing: border-box;
        padding: 60px;
        background-image: linear-gradient(to right, rgb(213, 236, 196), rgb(86, 238, 86));
        border-radius: 20px;
        box-shadow: 25px 25px 75px rgba(0, 0, 0, 0.25),
            10px 10px 70px rgba(0, 0, 0, 0.25),
            inset 5px 5px 10px rgba(0, 0, 0, 0.5),
            inset 5px 5px 10px rgba(255, 255, 255, 0.2),
            inset -5px -5px 15px rgba(0, 0, 0, 0.75);
    }

    .login .fixed {
        position: relative;
        margin-bottom: 5px;
        margin-top: 5px;
        width: 220px;
        height: 25px;
        outline: none;
        border-radius: 10px;
    }

    .login button {
        position: relative;
        top: 30px;
        border-radius: 10px;
        margin: 10px 0px 0px 20px;
        width: 100px;
        height: 40px;
        border: none;
        transition: all .4s ease-in-out;
    }

    button:hover {
        cursor: pointer;
        background-image: linear-gradient(to right, green, yellow);
        transition: all .4s ease-in-out;
        box-shadow: 2px 3px 5px 0 red;
    }

    #icon,
    #iconClose {
        position: relative;
        top: 2px;
        left: -30px;
    }

    #icon:hover,
    #iconClose:hover {
        cursor: pointer;
    }

    .okAcount {
        position: relative;
        top: 50px;
        text-align: center;
    }

    .okAcount a {
        text-decoration: none;
    }

    #ok-rules {
        display: none;
    }
</style>

<body>



    <div class="container">
        <div class="login">

            <!-- Username -->
            <label for="username">Username</label> <br>
            <input id='username' type="text" class="fixed" onkeypress="entry1(event,'email')" placeholder="Username">
            <br>
            <span id="usernameExits" style="display:none">Username exists</span>
            <span class="errorUserName" id="errorUserName" style="display: none">Username sai định dạng</span>
            <!-- Email -->
            <label for="email"> Email </label> <br>
            <input id="email" type="text" class="fixed" onkeypress="entry1(event,'password')" placeholder="Email"> <br>
            <span id="emailExits" style="display:none">Email exists</span>
            <span class="errorMail" id="errorMail" style="display: none">Email is wrong format</span>
            <!-- Password -->
            <label for="password">Password</label> <br>
            <input id="password" class="fixed" type="password" onkeypress="entry1(event,'confirmPassword')"
                placeholder="Password">
            <i id="icon" onclick="showPassword()" class="fa-solid fa-eye"></i> <br>
            <span class="error" id="error" style="display: none">Wrong password</span>
            <!-- Confirm Password -->

            <label for="confirmPassword">Confirm password </label> <br>
            <input id="confirmPassword" class="fixed" type="password" onkeydown="entry(event)"
                placeholder="Confirm Password">
            <i id="iconClose" onclick="showConfirmPassword()" class="fa-solid fa-eye"></i>
            <span id="confirmError" style="display:none">Input password does not match</span> <br> <br>
            <!-- Nhớ tôi và quên mật khẩu -->
            <input class="ok" id="checked" name="rules" type="checkbox">
            <label for="checked">Agree to the <a href="#">terms</a></label> <br>
            <span id="ok-rules">You must agree to the terms</span>
            <!-- Nút đăng kí -->
            <button onclick="register()">Register</button>
            <button onclick="cancel()">Cancel</button>

            <!-- Thông báo chỉ dẫn -->
            <div class="okAcount">
                You already have an account. <br> <a href="/login.html">Login</a>
            </div>
        </div>
    </div>



    <script>

        function checkUserName(username) {
            let re = /^[a-zA-Z0-9\-]+$/
            if (re.test(username)) {
                return true
            } else {
                return false
            }
        }

        function checkMail(mail) {
            let re = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
            if (re.test(mail)) {
                return true
            } else {
                return false;
            }
        }

        function register() {
            // Kiểm tra tên đăng nhập
            let username = document.getElementById('username');
            let errorUserName = document.getElementById("errorUserName");
            if (checkUserName(username.value) == false) {
                errorUserName.setAttribute("style", "display:block; color:red");
                username.setAttribute("style", "border: 2px solid red");
            } else {
                username.setAttribute("style", "border: auto");
                errorUserName.setAttribute("style", "display:none");
            }
            // Kiểm tra email
            let mail = document.getElementById("email");
            let errorMail = document.getElementById("errorMail");
            if (checkMail(mail.value) == false) {
                errorMail.setAttribute("style", "display:block; color:red");
                mail.setAttribute("style", "border: 2px solid red");
            } else {
                errorMail.setAttribute("style", "display:none");
                mail.setAttribute("style", "border:auto");
            }
            // Kiểm tra mật khẩu
            let pass = document.getElementById("password");
            let errorPass = document.getElementById("error");
            if (pass.value.length < 6 || pass.value.indexOf(" ") != -1) {
                errorPass.setAttribute("style", "display:block;color:red");
                pass.setAttribute("style", "border: 2px solid red");
            } else {
                errorPass.setAttribute("style", "display:none");
                pass.setAttribute("style", "border:auto");
            }
            // Xác nhận mật khẩu và đăng nhập
            //1. Xác nhận mật khẩu
            let passConfirm = document.getElementById("confirmPassword");
            let errorConfirm = document.getElementById("confirmError");
            if (passConfirm.value != pass.value || passConfirm.value == "") {
                errorConfirm.setAttribute("style", "display:block;color:red");
                passConfirm.setAttribute("style", "border: 2px solid red");
            } else {
                errorConfirm.setAttribute("style", "display:none");
                passConfirm.setAttribute("style", "border:auto");

            }
            //2. Kiểm tra điều kiện đăng nhập khi đúng hết
            if (checkUserName(username.value) && checkMail(mail.value) && (pass.value.length >= 6 && pass.value.indexOf(" ") == -1) && (passConfirm.value == pass.value)) {
                let obj = {
                    username: username.value,
                    email: mail.value,
                    password: pass.value
                }
                // 2.1. Lấy thông tin trên bộ nhớ về
                let getInformation = localStorage.getItem("information");
                // 2.1.1. Khi trường thông tin trên bộ nhớ rỗng
                if (getInformation == null) {
                    getInformation = [];
                    let checkbox = document.getElementsByName("rules");
                    let okRules = document.getElementById("ok-rules");
                    // Kiểm tra nút check 
                    if (checkbox[0].checked != true) {
                        okRules.setAttribute("style", "display:block;color:red");
                    } else {
                        okRules.setAttribute("style", "display:none");
                        getInformation.push(obj);
                        // Đẩy thông tin lên bộ nhớ và chuyển trang
                        localStorage.setItem("information", JSON.stringify(getInformation));
                        window.location.href = "/login.html";
                        document.getElementById("username").value = "";
                        document.getElementById("email").value = "";
                        document.getElementById("confirmPassword").value = "";
                        document.getElementById("password").value = "";
                        alert("Đăng ký thành công");
                    }
                } else {
                    // 2.1.2. Khi bộ nhớ không rỗng
                    getInformation = JSON.parse(getInformation);
                    let emailExits = document.getElementById("emailExits");
                    let usernameExits = document.getElementById("usernameExits");

                    let flag1;
                    let flag2;
                    // Kiểm tra trùng Email hay không
                    for (let i = 0; i < getInformation.length; i++) {
                        if (obj.email == getInformation[i].email) {
                            emailExits.setAttribute("style", "display:block;color:red");
                            mail.setAttribute("style", "border: 2px solid red");
                            flag1 = false;
                            break;
                        } else {
                            emailExits.setAttribute("style", "display:none");
                            mail.setAttribute("style", "border:auto");
                            flag1 = true;
                        }
                    }
                    // Kiểm tra trùng tên đăng nhập không
                    for (let i = 0; i < getInformation.length; i++) {
                        if (obj.username == getInformation[i].username) {
                            usernameExits.setAttribute("style", "display:block;color:red");
                            username.setAttribute("style", "border: 2px solid red");
                            flag2 = false;
                            break;
                        } else {
                            usernameExits.setAttribute("style", "display:none");
                            username.setAttribute("style", "border:auto");
                            flag2 = true;
                        }
                    }
                    // Đẩy thông tin tài khoản mới lên bộ nhớ sau khi check điều khoản và chuyển trang
                    if (flag1 == true && flag2 == true) {
                        let checkbox = document.getElementsByName("rules");
                        let okRules = document.getElementById("ok-rules");
                        if (checkbox[0].checked != true) {
                            okRules.setAttribute("style", "display:block;color:red");
                        } else {
                            okRules.setAttribute("style", "display:none");
                            getInformation.push(obj);
                            localStorage.setItem("information", JSON.stringify(getInformation));
                            window.location.href = "/login.html";
                            document.getElementById("username").value = "";
                            document.getElementById("email").value = "";
                            document.getElementById("confirmPassword").value = "";
                            document.getElementById("password").value = "";
                            alert("Đăng ký thành công");
                        }
                    }
                }
            }
        }

        function showPassword() {
            let password = document.getElementById("password");
            let icon = document.getElementById("icon");
            if (password.type == "password") {
                password.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                password.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        function showConfirmPassword() {
            let showConfirmPassword = document.getElementById("confirmPassword");
            let iconClose = document.getElementById("iconClose");
            if (showConfirmPassword.type == "password") {
                showConfirmPassword.type = "text";
                iconClose.classList.remove("fa-eye");
                iconClose.classList.add("fa-eye-slash");
            } else {
                showConfirmPassword.type = "password";
                iconClose.classList.remove("fa-eye-slash");
                iconClose.classList.add("fa-eye");
            }
        }

        function cancel() {
            window.location.href = "/index.html"
        }

        function entry(event) {
            if (event.key == "Enter") {
                register();
            }
        }

        function entry1(event, input) {
            if (event.key == "Enter") {
                let idInput = document.getElementById(input);
                idInput.focus();
            }
        }
    </script>
</body>

</html>